---
layout: post
title: "가상화와 도커"
author: "한결"
categories: blog
---

### 가상화 Virtualization



가상화는 1960년대에 처음 시작되어 2000년대에 이르러 널리 도입된다. 이유는 기술이 발전하며 하드웨어의 성능이 좋아지며 많은 사람들에게 보급되기 시작했기 때문이다. 하드웨어의 성능이 좋아지며 사용되지 않는 리소스를 활용하기 위해 가상화 기술이 개발되었다.

* 서버 가상화

  서버 가상화는 가장 일반적이며 가상머신에 서버를 구축하는 것이다. 리소스 활용률을 높이고자 CPU 메모리를 논리적으로 나누어 사용한다. 시스템 자원을 나누기 위해 파티셔닝 기술이 필요하며 현재는 소프트웨어 파티셔닝 기술이 주로 사용된다. 가상머신에 시스템 자원을 할당해주는 소프트웨어를 하이퍼바이저라고 한다.

  * 하이퍼바이저

    VMware, Virtual Box 가 대표적인 하이퍼바이저 소프트웨어다. 호스트가 소프트웨어 파티셔닝을 할 수 있게 돕는다. 가상머신에 리소스를 할당해주고 관리할 수 있다. 서로 독립적인 환경을 사용할 수 있도록 리소스간 접근 방지 기능으로 보안성을 높였다. 

* 네트워크 가상화

  네트워크 가상화는 디렉터리 서비스, 파일 공유, IP 설정 같은 네트워크의 주요 기능을 분리한다. L2, L3, L7 스위치와 네트워크 방화벽, 보안 장비 등을 가상머신으로 구현하여 물리 구성요소의 수를 줄여준다. 물리적으로 보면 통합된 네트워크도 가상으로 네트워크를 나누어 사용하고 필요하지 않으면 다시 회수하는 형태로 사용할 수 있다. 속도와 유연성이 높아졌다. NFV(Network Function Virtualization), SDN(Software Defined Network)가 있다.

* 스토리지 가상화

  RAID 처럼 여러개의 물리적인 드라이브를 하나의 논리적 드라이브처럼 사용한다. 디스크를 효율적으로 사용하며 확장 역시 쉽다. SDS(Software defined Storage)

  오픈소스 SDS 스토리지 = Ceph, Glusterfs

* 컨테이너 가상화

  호스트 운영체제에서 논리적인 구역을 생성하여 각각 독립적인 애플리케이션을 실행하는 기술이다. 논리적 구역을 컨테이너라 지칭하며 애플리케이션과 필요한 라이브러리를 추가할 수 있다. 주로 커널기능을 사용하며 이는 서버 가상화보다 리소스를 효율적으로 사용이 가능하며 속도 역시 빠르다.

  * 리눅스 컨테이너

    가상머신과 다르게 컨테이너는 가상화 계층이 없고 커널이 별도로 존재하지 않는다. 그렇기 때문에 가상머신에 비해 가볍고 실행 속도 또한 빠르다. 시스템 자원을 훨씬 절약시킨다.

    리눅스 컨테이너는 도커가 개발된 이후부터 활발히 사용되고 있다. 도커는 리눅스 컨테이너를 다루는 도구이며 컨테이너 런타임이라고도 지칭한다.

    리눅스 컨테이너에서의 핵심 기술은 cgroup와 namespace 이다.

    * cgroup

      cgroup는 crontrol group의 약자이며 프로세스 또는 쓰레드를 그룹화하여 관리한다. 또 시스템 리소스의 사용을 제한하며 같은 호스트에서 동작하는 서로 다른 컨테이너에 영향을 주지 않게 막아준다.

    * namespace 

      namespace 라는 공간에 다수의 오브젝트를 격리할 수 있다. 원래대로라면 동일한 호스트에서 동일한 PID를 가질 수 없지만 namespace에서는 동일한 PID를 가질 수 있다.



### Docker

도커는 Go 언어로 개발된 오픈소스 플랫폼으로 리눅스 컨테이너를 쉽게 관리할 수 있도록 돕는다. 도커의 가장 큰 특징은 이식성으로 개발 환경, 테스트 환경, 서비스 환경을 모두 동일하게 사용이 가능하다.

* 서버를 코드 형태로 정의

  도커는 이미지를 사용하여 컨테이너를 실행한다. 이미지를 제작할 때 코드형태로 정의하여 작성할 수 있어 일관성을 유지할 수 있고 버전 관리도 편리하다.

* 이식성

  애플리케이션 개발 단계는 크게 개발, 테스트, 서비스 단계로 나뉘는데 각 단계의 환경을 통일하기가 쉽지 않다. 하지만 도커를 사용하면 동일한 환경을 구축하는 것이 편리하다.

* 상호운용성

  도커는 google, amazon, ibm, microsoft, red hat 등 다양한 벤더사에서 지원한다. 벤더들의 시스템 및 오픈소스와 연계해서 사용이 가능하다.



### Docker 구조

1. 이미지

   컨테이너를 생성하기 위해서는 이미지가 있어야 한다. 이미지는 여러개의 레이어로 이루어져 있으며 레이어는 Read Only 상태로 사용된다. 이미지로 생성한 컨테이너에서 추가나 삭제 등의 과정이 이루어진다면 새로운 레이어가 생성되어 저장된다. 

2. 저장소

   이미지는 호스트가 아닌 외부에 저장되어 공유할 수 있어야 한다. 이미지를 저장하는 공간을 저장소라고 하며 범위에 따라 퍼블릭 이미지 저장소와 프라이빗 이미지 저장소로 나뉜다.

   대표적인 이미지 저장소로는 Docker Hub가 있으며 퍼블릭과 프라이빗 이미지 저장소 둘 다 사용이 가능하다. 또 Harbor나 도커 레지스트리 같은 프라이빗 이미지 저장소를 별도로 만들 수도 있다. 

3. 컨테이너

   이미지를 실행한 결과물이 컨테이너이다. 하나의 컨테이너에는 하나의 애플리케이션만 실행되는 것을 권장하며 추가로 실행할 수는 있지만 유지를 권장하지는 않는다. 이미지가 메모리에 올라가면 컨테이너, 컨테이너가 디스크



### Docker 기능

1. 이미지 생성

   도커는 다양한 방법으로 이미지를 생성할 수 있지만 가장 대표적인 것이 Dockerfile이다. 그 외로는 docker commit 명령과 컨테이너 파일 시스템으로 이미지를 생성하는 docker export 와 docker import 가 있다.

2. 이미지 공유

   도커는 저장소를 통해 이미지를 공유한다. 도커허브 뿐만 아니라 다른 프라이빗 이미지 저장소도 사용이 가능하다.

3. 컨테이너 생성

   컨테이너를 생성하고 관리하는 컨테이너 런타임이다. 컨테이너를 생성하고 네트워크, 볼륨과 같은 도커 오브젝트를 생성한 뒤 컨테이너에 연결하여 사용이 가능하다.

   





